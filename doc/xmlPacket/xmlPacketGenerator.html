<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>EVEmu Developer documentation - XML Packet Generator</title>

    <!-- jQuery & QUnit -->
    <script type="text/javascript" src="js/jquery-1.4.2.js"></script>
    <script type="text/javascript" src="js/qunit.js"></script>
    <link type="text/css" rel="stylesheet" href="js/qunit.css"/>
    <!-- SyntaxHighlighter -->
    <script type="text/javascript" src="../syntaxhighlighter_3.0.83/scripts/shCore.js"></script>
    <script type="text/javascript" src="../syntaxhighlighter_3.0.83/scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../syntaxhighlighter_3.0.83/scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../syntaxhighlighter_3.0.83/scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="../syntaxhighlighter_3.0.83/scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../syntaxhighlighter_3.0.83/scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="../syntaxhighlighter_3.0.83/scripts/shBrushXml.js"></script>

    <link type="text/css" rel="stylesheet" href="../syntaxhighlighter_3.0.83/styles/shCoreDefault.css"/>
    <script type="text/javascript">SyntaxHighlighter.all();</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
  </head>
  <body>
    <h3>The Packet Generator</h3>
    The data packets exchanged between the client and server are handled by packet class objects.
    These objects are automatically generated by the XML Packet Generator.
    The packet generator accepts the following command line arguments.
    <table border="1">
      <tr>
        <td>argument</td>
        <td>description</td>
      </tr>
      <tr>
        <td>-I</td>
        <td>The location to store the c++ header file(s).</td>
      </tr>
      <tr>
        <td>-S</td>
        <td>The location to store the c++ source file(s).</td>
      </tr>
      <tr>
        <td>-h</td>
        <td>Show the help output.</td>
      </tr>
      <tr>
        <td>filename</td>
        <td>The xmlp file to parse.<br>Multiple files may be specified.<br>Filenames MUST be last argument.</td>
      </tr>
    </table>
    <br>
    The xmlp files are parsed as xml files such as the Sovereignty.xmlp file.
    <pre class="brush: xml">
<elements>
  <elementDef name="RspGetSystemSovereigntyInfo">
    <tupleInline>
      <int name="contested" />
      <int name="corporationID" />
      <int name="claimTime" />
      <int name="claimStructureID" />
      <int name="hubID" />
      <int name="allianceID" />
      <int name="solarSystemID" />
    </tupleInline>
  </elementDef>
</elements>
    </pre>
    The root tag is &lt;elements&gt; it contains all the data and should only occur once.
    Nothing should exist outside the &lt;elements&gt; tag.
    The &lt;elements&gt; tag may contain &lt;include&gt; and &lt;elementDef&gt; tags.
    <br>
    The &lt;include&gt; tag specifies any additional include files that should be added to the header.
    The file is specified as a xml attribute as in the following.
    <pre class="brush: xml">
  &lt;include file="packets/General.h"/&gt;
    </pre>
    The &lt;elementDef&gt; tag describes a data packet that may be transmitted.
    The name attribute identifies the name of the class to generate.
    It may contain one (and only one) data element.  This defines the data type of the packet.
    <table border='1'>
      <tr>
        <td>element</td>
        <td>attributes</td>
        <td>Python type</td>
        <td>C++ type</td>
        <td>description</td>
      </tr>
      <tr><td>elementDef</td>
        <td>name</td>
        <td>PyRep</td>
        <td></td>
        <td>Defines a c++ class.</td>
      </tr>
      <tr><td>element</td>
        <td>name<br>type</td>
        <td>PyRep</td>
        <td>(type)</td>
        <td>Some data of the specified type.</td>
      </tr>
      <tr><td>elementPtr</td>
        <td>name<br>type</td>
        <td>PyRep</td>
        <td>(type *)</td>
        <td>A pointer to an element of the specified type.</td>
      </tr>
      <tr><td>raw</td>
        <td>name</td>
        <td>PyRep</td>
        <td>PyRep *</td>
        <td>Some raw data.</td>
      </tr>
      <tr><td>int</td>
        <td>name</td>
        <td>PyInt</td>
        <td>int32</td>
        <td>A integer value.</td>
      </tr>
      <tr><td>long</td>
        <td>name</td>
        <td>PyLong</td>
        <td>int64</td>
        <td>A long integer value.</td>
      </tr>
      <tr><td>real</td>
        <td>name</td>
        <td>PyFloat</td>
        <td>double</td>
        <td>A double precession floating point value.</td>
      </tr>
      <tr><td>bool</td>
        <td>name</td>
        <td>PyBool</td>
        <td>bool</td>
        <td>A boolean value.</td>
      </tr>
      <tr><td>none</td>
        <td></td>
        <td>PyNone</td>
        <td></td>
        <td>Nothing!</td>
      </tr>
      <tr><td>buffer</td>
        <td>name</td>
        <td>PyBuffer</td>
        <td>PyBuffer *</td>
        <td>A pointer to a buffer.</td>
      </tr>
      <tr><td>string</td>
        <td>name</td>
        <td>PyString</td>
        <td>std::string</td>
        <td>A string.</td>
      </tr>
      <tr><td>stringInline</td>
        <td>value</td>
        <td>PyString</td>
        <td></td>
        <td>An explicitly declared string with the specified value.</td>
      </tr>
      <tr><td>wstring</td>
        <td>name</td>
        <td>PyWString</td>
        <td>std::string</td>
        <td>A wide string.</td>
      </tr>
      <tr><td>wstringInline</td>
        <td>value</td>
        <td>PyWString</td>
        <td></td>
        <td>An explicitly declared wide string with the specified value.</td>
      </tr>
      <tr><td>token</td>
        <td>name</td>
        <td>PyToken</td>
        <td>PyToken *</td>
        <td>A pointer to a token.</td>
      </tr>
      <tr><td>tokenInline</td>
        <td>value</td>
        <td>PyToken</td>
        <td></td>
        <td>An explicitly declared token with the specified value.</td>
      </tr>
      <tr><td>object</td>
        <td>name</td>
        <td>PyObject</td>
        <td>PyObject *</td>
        <td>A pointer to an object of undefined type.</td>
      </tr>
      <tr><td>objectInline</td>
        <td></td>
        <td>PyObject</td>
        <td></td>
        <td>An explicitly declared object.</td>
      </tr>
      <tr><td>objectEx</td>
        <td>name<br>type</td>
        <td>PyObjectEx</td>
        <td>(type *)</td>
        <td>A pointer to an object of the specified type.</td>
      </tr>
      <tr><td>tuple</td>
        <td>name</td>
        <td>PyTuple</td>
        <td>PyTuple *  </td
        ><td>A tuple.</td>
      </tr>
      <tr><td>tupleInline</td>
        <td></td>
        <td>PyTuple</td>
        <td></td>
        <td>An explicitly declared tuple.</td>
      </tr>
      <tr><td>list</td>
        <td>name</td>
        <td>PyList</td>
        <td>PyList *</td>
        <td>A list of objects.</td>
      </tr>
      <tr><td>listInline</td>
        <td></td>
        <td>PyList</td>
        <td></td>
        <td>A explicitly declared list of objects.</td>
      </tr>
      <tr><td>listInt</td>
        <td>name</td>
        <td>PyList</td>
        <td>std::vector&lt;int32&gt;</td>
        <td>A list of integer values.</td>
      </tr>
      <tr><td>listLong</td>
        <td>name</td>
        <td>PyList</td>
        <td>std::vector&lt;int64&gt;</td>
        <td>A list of long integer values.</td>
      </tr>
      <tr><td>listStr</td>
        <td>name</td>
        <td>PyList</td>
        <td>std::vector&lt;std::string&gt;</td>
        <td>A list of string values.</td>
      </tr>
      <tr><td>dict</td>
        <td>name</td>
        <td>PyDict</td>
        <td>PyDict*</td>
        <td>A map of objects.</td>
      </tr>
      <tr><td>dictInline</td>
        <td></td>
        <td>PyDict</td>
        <td></td>
        <td>An explicitly declared dictionary.  Generates a pyDict structure.</td>
      </tr>
      <tr><td>dictInlineEntry</td>
        <td>key</td>
        <td></td>
        <td></td>
        <td>An entry for a dictInline structure.  Key is the dictionary index, the vale is a sub element.</td>
      </tr>
      <tr><td>dictRaw</td>
        <td>name<br>key<br>pykey<br>value<br>pyvalue</td>
        <td>PyDict</td>
        <td>std::map&lt;key, value&gt;</td>
        <td>A map of (value) values indexed with a (key) type. Checks map types are Py(pykey) and Py(pyvalue).</td>
      </tr>
      <tr><td>dictInt</td>
        <td>name</td>
        <td>PyDict</td>
        <td>std::map&lt;int32, PyRep *&gt;</td>
        <td>A map of objects indexed by a integer value.</td>
      </tr>
      <tr><td>dictStr</td>
        <td>name</td>
        <td>PyDict</td>
        <td>std:;map&lt;std::string, PyRep *&gt;</td>
        <td>A map of objects indexed by a string.</td>
      </tr>
      <tr><td>substreamInline</td>
        <td></td>
        <td>PySubStream</td>
        <td></td>
        <td></td>
      </tr>
      <tr><td>substructInline</td>
        <td></td>
        <td>PySubStruct</td>
        <td></td>
        <td></td>
      </tr>
    </table>
    <br>
    <h4>Basic data types</h4>
    Basic data types such as int, long, string, and real are used in the following way.
    <pre class="brush: xml">
  &lt;elementDef name="anInfoPacket"&gt;
    &lt;tupleInline&gt;
      &lt;int name="qty"/&gt;
      &lt;real name="value"/&gt;
      &lt;string name="what"/&gt;
    &lt;/tupleInline&gt;
  &lt;/elementDef&gt;
    </pre>
    Would generate a class with the following data types.
    <pre class="brush: xml">
  class anInfoPacket {
    bool Decode( PyRep* packet );
    bool Decode( PyRep** packet );
    bool Decode( PyTuple** packet );
    PyTuple* Encode() const;

    int32 qty;
    double value;
    std::string what;
  }
    </pre>
    This class would require a PyTuple for input and would encode its data to a PyTuple.
    <h4>Basic Inline data types</h4>
    Inline types allow for explicitly stating values.
    The following change would require that the string "request" be the first item in the data packet.
    Since this is explicit it would not be stored in the class and would be automatically added to the encoded packet.
    <pre class="brush: xml">
  &lt;elementDef name="anInfoPacket"&gt;
    &lt;tupleInline&gt;
      &lt;stringinline value="request"/&gt;
      &lt;int name="qty"/&gt;
      &lt;real name="value"/&gt;
      &lt;string name="what"/&gt;
    &lt;/tupleInline&gt;
  &lt;/elementDef&gt;
    </pre>
    <h4>dictInline, dictInlineEntry</h4>
    A in line dictionary.  The following would generate a PyDict structure with two entries ("who" and "what").
    <pre class="brush: xml">
  &lt;dictInline&gt;
    &lt;dictInlineEntry key="what"&gt;
      &lt;stringInline value="An important message from EVEmu."/&gt;
    &lt;/dictInlineEntry&gt;
    &lt;dictInlineEntry key="who"&gt;
      &lt;stringInline value="From someone who cares."/&gt;
    &lt;/dictInlineEntry&gt;
  &lt;/dictInline&gt;
    </pre>
  </body>
</html>
